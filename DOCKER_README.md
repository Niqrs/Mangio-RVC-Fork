# Docker Setup –¥–ª—è Mangio RVC Fork üê≥

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –∑–∞–ø—É—Å—Ç–∏—Ç—å Mangio RVC Fork –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

## üçé –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è macOS

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Mac, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è macOS:

```bash
# –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –¥–ª—è Mac
docker-compose -f docker-compose.mac.yml build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose -f docker-compose.mac.yml up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose -f docker-compose.mac.yml logs -f
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:7865

### üöÄ –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è Mac:
- **–ù–∞ Apple Silicon (M1/M2/M3/M4)**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **MPS (Metal Performance Shaders)** –¥–ª—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è üî•
- **–ù–∞ Intel Mac**: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU
- –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 15-30 –º–∏–Ω—É—Ç
- **M4 Pro/Max/Ultra** –ø–æ–ª—É—á–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –±–ª–∞–≥–æ–¥–∞—Ä—è MPS

### ‚ö° –ü—Ä–æ–≤–µ—Ä–∫–∞ MPS —É—Å–∫–æ—Ä–µ–Ω–∏—è:

–í –ª–æ–≥–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
No supported Nvidia GPU found, use MPS instead
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Metal!

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–ª—è GPU –≤–µ—Ä—Å–∏–∏:
- Docker –∏ Docker Compose
- NVIDIA GPU —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA 11.8+
- NVIDIA Docker runtime (nvidia-docker2)
- –ú–∏–Ω–∏–º—É–º 8GB VRAM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 12GB+)

### –î–ª—è CPU –≤–µ—Ä—Å–∏–∏:
- Docker –∏ Docker Compose
- –ú–∏–Ω–∏–º—É–º 16GB RAM
- –ú–æ—â–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8+ —è–¥–µ—Ä)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π:

```bash
chmod +x download_models.sh
./download_models.sh
```

–≠—Ç–æ —Å–∫–∞—á–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥–µ–ª–∏ (~3GB). –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∏ –Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ.

### –®–∞–≥ 2: –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –í–∞—Ä–∏–∞–Ω—Ç A: –° –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
docker-compose build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –¢–æ–ª—å–∫–æ CPU (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)

```bash
# –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –¥–ª—è CPU
docker-compose -f docker-compose.cpu.yml build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker-compose -f docker-compose.cpu.yml up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose -f docker-compose.cpu.yml logs -f
```

### –®–∞–≥ 3: –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:7865
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker-compose down
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker-compose restart
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

### –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
```bash
docker-compose exec mangio-rvc bash
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

- `./logs/` - –õ–æ–≥–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –º–æ–¥–µ–ª–∏
- `./weights/` - –í–µ—Å–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π  
- `./audio-outputs/` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ
- `./datasets/` - –î–∞—Ç–∞—Å–µ—Ç—ã –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- `./audios/` - –í—Ö–æ–¥–Ω—ã–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã

–í—Å–µ —ç—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –ø–æ—ç—Ç–æ–º—É –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏.

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—à–∏–±–∫–∞ "nvidia-docker runtime not found"

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nvidia-docker2:
```bash
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update && sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker
```

### 2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ GPU

–£–º–µ–Ω—å—à–∏—Ç–µ batch size –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU –≤–µ—Ä—Å–∏—é.

### 3. –ü–æ—Ä—Ç 7865 –∑–∞–Ω—è—Ç

–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ docker-compose.yml:
```yaml
ports:
  - "8080:7865"  # –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç
```

### 4. –û—à–∏–±–∫–∏ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
sudo chmod -R 777 logs weights audio-outputs datasets audios
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è GPU –≤–µ—Ä—Å–∏–∏

–í `docker-compose.yml` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```yaml
environment:
  - NVIDIA_VISIBLE_DEVICES=0  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é GPU
  - CUDA_VISIBLE_DEVICES=0    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±
```

### –î–ª—è CPU –≤–µ—Ä—Å–∏–∏

–í `docker-compose.cpu.yml` –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç—ã:

```yaml
deploy:
  resources:
    limits:
      cpus: '16'      # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä CPU
      memory: 32G     # –û–±—ä–µ–º RAM
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫** –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 10-20 –º–∏–Ω—É—Ç –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. **GPU –≤–µ—Ä—Å–∏—è** —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 10-50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ CPU –≤–µ—Ä—Å–∏–∏
3. **–ú–æ–¥–µ–ª–∏ v2** —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, –Ω–æ –¥–∞—é—Ç –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
4. **UVR5 –º–æ–¥–µ–ª–∏** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ—Ç–¥–µ–ª–µ–Ω–∏—è –≤–æ–∫–∞–ª–∞ –æ—Ç –º—É–∑—ã–∫–∏

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

```bash
git pull
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ —Å–∫–∞—á–∞–Ω—ã: `ls -la pretrained/`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Docker: `docker --version`
4. –î–ª—è GPU: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ CUDA: `nvidia-smi`

## üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞ –≤ Docker Hub

### –û–±—ã—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ (–¥–ª—è —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x build_and_push.sh

# –°–æ–±—Ä–∞—Ç—å –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑
./build_and_push.sh -u YOUR_DOCKERHUB_USERNAME

# –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
./build_and_push.sh -u YOUR_USERNAME -n custom-name -v 1.0.0
```

### –ú–Ω–æ–≥–æ–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–±–æ—Ä–∫–∞ (Intel + Apple Silicon)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤:

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x build_and_push_multiarch.sh

# –°–æ–±—Ä–∞—Ç—å –¥–ª—è –æ–±–µ–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä
./build_and_push_multiarch.sh -u YOUR_DOCKERHUB_USERNAME
```

### –û–ø—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤

- `-u, --username` - Docker Hub username (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `-n, --name` - –ò–º—è –æ–±—Ä–∞–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: mangio-rvc-mac)
- `-v, --version` - –í–µ—Ä—Å–∏—è/—Ç–µ–≥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: latest)
- `--no-cache` - –°–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
- `-h, --help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

–ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ª—é–±–æ–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à –æ–±—Ä–∞–∑:

```bash
# –ó–∞–ø—É—Å–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
docker run -d -p 7865:7865 YOUR_USERNAME/mangio-rvc-mac:latest

# –ò–ª–∏ —á–µ—Ä–µ–∑ docker-compose
# –ò–∑–º–µ–Ω–∏—Ç–µ –≤ docker-compose.mac.yml:
# image: YOUR_USERNAME/mangio-rvc-mac:latest
docker-compose -f docker-compose.mac.yml up -d
```

## ‚òÅÔ∏è –ó–∞–ø—É—Å–∫ –Ω–∞ RunPod (–æ–±–ª–∞—á–Ω—ã–µ GPU)

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ—â–Ω—ã—Ö –æ–±–ª–∞—á–Ω—ã—Ö GPU –Ω–∞ RunPod:

### 1. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –¥–ª—è RunPod:
```bash
chmod +x build_and_push_runpod.sh
./build_and_push_runpod.sh -u YOUR_DOCKERHUB_USERNAME
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ RunPod:
- **Docker Image**: `YOUR_USERNAME/mangio-rvc-runpod:latest`
- **Exposed Port**: `3000`
- **GPU**: –õ—é–±–∞—è NVIDIA (RTX 3080/4090/A100/H100)

### 3. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ RunPod:
- üöÄ **–ú–æ—â–Ω—ã–µ GPU**: RTX 4090, A100, H100
- ‚ö° **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í 10-50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ CPU
- üí∞ **–û–ø–ª–∞—Ç–∞ –ø–æ —Ñ–∞–∫—Ç—É**: –û—Ç $0.44/—á–∞—Å
- üåê **–î–æ—Å—Ç—É–ø –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞**: –ù–µ –Ω—É–∂–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ –∂–µ–ª–µ–∑–æ

üìñ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: —Å–º. [RUNPOD_GUIDE.md](./RUNPOD_GUIDE.md)

---

–£–¥–∞—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Mangio RVC Fork! üéµ 