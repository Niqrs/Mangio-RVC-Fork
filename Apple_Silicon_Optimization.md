# üçé Apple Silicon Optimization –¥–ª—è Mangio RVC

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –¥–ª—è M4 Pro

Docker –æ–±—Ä–∞–∑ —Ç–µ–ø–µ—Ä—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MPS (Metal Performance Shaders)** –Ω–∞ –≤–∞—à–µ–º M4 Pro —á–∏–ø–µ!

### ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ:
- **CPU-only (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)**: ~10-30 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **MPS (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)**: ~2-5 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚ö°

### üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

–¢–µ –∂–µ –∫–æ–º–∞–Ω–¥—ã, –Ω–æ —Ç–µ–ø–µ—Ä—å —Å GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º:

```bash
# –°–±–æ—Ä–∫–∞ (—Å MPS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π)
docker-compose -f docker-compose.mac.yml build

# –ó–∞–ø—É—Å–∫
docker-compose -f docker-compose.mac.yml up -d
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ MPS —Ä–∞–±–æ—Ç–∞–µ—Ç:

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```bash
docker-compose -f docker-compose.mac.yml logs | grep MPS
# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# "No supported Nvidia GPU found, use MPS instead"
```

### üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

–£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `docker-compose.mac.yml`:
```yaml
environment:
  - PYTORCH_MPS_HIGH_WATERMARK_RATIO=0.0  # –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å
  - PYTORCH_ENABLE_MPS_FALLBACK=1         # –û—Ç–∫–∞—Ç –Ω–∞ CPU –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
```

### üìä –û–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –ú–æ–¥–µ–ª—å    | CPU (Intel i7) | CPU (M4 Pro) | MPS (M4 Pro)   |
| --------- | -------------- | ------------ | -------------- |
| Inference | 15-30s         | 8-15s        | **2-5s** ‚ö°     |
| Training  | 2-5 min        | 1-3 min      | **30s-1min** ‚ö° |

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ MPS –≤–µ—Ä—Å–∏—é** –Ω–∞ Apple Silicon
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å** - MPS –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ unified memory
3. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö OOM** - —É–º–µ–Ω—å—à–∏—Ç–µ batch size –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

---

*–í–∞—à M4 Pro —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ–ª–Ω—É—é –º–æ—â–Ω–æ—Å—Ç—å! üöÄ* 